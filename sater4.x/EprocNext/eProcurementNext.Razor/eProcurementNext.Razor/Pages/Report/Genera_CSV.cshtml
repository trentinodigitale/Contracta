@page "/Report/Genera_CSV.asp"
@inject eProcurementNext.Session.ISession session;
@using eProcurementNext.CommonDB
@using eProcurementNext.CommonModule;
@using static eProcurementNext.CommonModule.Basic;
@using eProcurementNext.BizDB;
@using eProcurementNext.HTML;
@using eProcurementNext.Application;
@using Microsoft.VisualBasic
@using static eProcurementNext.CommonDB.Basic;
@using static eProcurementNext.Razor.Pages.CTL_LIBRARY.DOCUMENT.print_documentModel;
@using static eProcurementNext.Razor.Pages.CTL_LIBRARY.DOCUMENT.CommonModel;
@using static eProcurementNext.Razor.Pages.Report.Genera_CSVModel;
@model eProcurementNext.Razor.Pages.Report.Genera_CSVModel
@using static eProcurementNext.Session.SessionMiddleware
@{
	CommonDbFunctions cdf = new();
	LoadSession(HttpContext, session);
	EprocResponse htmlToReturn = new();
	
	objDoc = PrintDocument(session, htmlToReturn, HttpContext,Response,Request);//PrintDocument ok
}
@{
	htmlToReturn.Clear();
	string strfilename = "";
	strfilename = DOC_Field("TESTATA", "Titolo") + $@".csv";

	Response.ContentType = "application/CSV";
	Response.Headers.Add("content-disposition", "attachment; filename=" + strfilename);


	int row = 0;
	row = DOC_NumRow("MODELLI", "");
	for(int i = 0;i<row-1;i++)
	{
		htmlToReturn.Write ($@"""" + DOC_FieldRow( "MODELLI", "Descrizione", i ).Replace(@"""",@"""""") + @"""" );

		if(i<row-1)
		{
			htmlToReturn.Write(";");
		}
	}
	throw new ResponseEndException(htmlToReturn.Out(), Response, "");
	try
	{
		FreeMemDocument(session);
	}
	catch
	{
		
	}
}@Html.Raw(htmlToReturn.Out())