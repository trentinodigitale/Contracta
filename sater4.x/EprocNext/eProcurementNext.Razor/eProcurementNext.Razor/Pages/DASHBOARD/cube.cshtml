@page "/DASHBOARD/cube.asp"
@using eProcurementNext.DashBoard
@using eProcurementNext.CommonModule
@using Microsoft.VisualBasic
@using eProcurementNext.HTML
@using static eProcurementNext.CommonModule.Basic
@using static eProcurementNext.Razor.Pages.CTL_LIBRARY.functions.intestModel
@using static eProcurementNext.Razor.Pages.CTL_LIBRARY.functions.cnvModel
@using static eProcurementNext.Razor.Pages.CTL_LIBRARY.functions.masterPageToolsModel    
@* <!-- #Include File="../home/layout.inc" --> *@
@inject eProcurementNext.Session.ISession session;
@using static eProcurementNext.Session.SessionMiddleware
@model eProcurementNext.Razor.Pages.DASHBOARD.cubeModel
@{
	Layout = ConfigurationServices.GetKey("LayoutVersion", "_masterPage");
	LoadSession(HttpContext, session);
	EprocResponse htmlToReturn = new EprocResponse(GetParamURL(HttpContext.Request.QueryString.ToString(), "XML_ATTACH_TYPE"));
}
@{
	string titoloViewer = "Lista";
	if(CStr( GetParamURL(Request.QueryString.ToString(), "CAPTION")) != "" )
	{
		titoloViewer = GetParamURL(Request.QueryString.ToString(), "CAPTION");
	}


	//drawMasterPage("../", titoloViewer);
	void  drawContent()
	{

		//'stop

		//'-- aggiungo alla query string del viewer, contenuta nelle molliche di pane, il parametro brcrumb a yes
		//'-- per sapere che sto tornando sul viewer dalle molliche di pane. (utile ad es. per ricaricare il vecchio filtro
		//'-- di ricerca fatto)
		string tempQS = GetQueryStringFromContext(Request.QueryString);

		if( Strings.InStr(1, tempQS, "&brcrumb=") > 0 )
		{
			string breadCrumb = GetParamURL(Request.QueryString.ToString(), "brcrumb");
			tempQS = tempQS.Replace("&brcrumb=" + breadCrumb, "&brcrumb=yes");
		}
		else
		{
			tempQS = tempQS + "&brcrumb=yes";
		}



		//'-- se mi trovo nel contesto di navigazione utente con un layout, aggiorno la current position dello stack.
		//'-- altrimenti no.
		//'if ( lcase(cstr(request.querystring("lo"))) <> "content" ) then
		
		stackUpdateCurrentPosition("viewer", "dashboard/Cube.asp?" + tempQS, titoloViewer,session, HttpContext);
		//'end if


		//'-- Funzione specifica per ogni pagina di template
		//ServerPageAccess "DASHBOARD.cube"	
        
		Cube cube= new Cube(HttpContext, session, htmlToReturn);
		cube.run();
	}
	drawContent();

	


}@Html.Raw(htmlToReturn.Out())