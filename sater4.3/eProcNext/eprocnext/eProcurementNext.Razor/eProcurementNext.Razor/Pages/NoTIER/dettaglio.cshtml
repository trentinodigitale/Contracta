@page "/NoTIER/dettaglio.asp"
@inject eProcurementNext.Session.ISession session;
@using eProcurementNext.CommonDB
@using eProcurementNext.CommonModule;
@using static eProcurementNext.CommonModule.Basic;
@using eProcurementNext.BizDB;
@using eProcurementNext.HTML;
@using eProcurementNext.Application;
@using static eProcurementNext.Razor.Pages.CTL_LIBRARY.functions.intestModel;
@using static eProcurementNext.Razor.Pages.CTL_LIBRARY.functions.securityModel;
@using static eProcurementNext.Razor.Pages.NoTIER.dettaglioModel;
@using Microsoft.VisualBasic;
@model eProcurementNext.Razor.Pages.NoTIER.dettaglioModel
@using static eProcurementNext.Session.SessionMiddleware
@{
	CommonDbFunctions cdf = new();
	LoadSession(HttpContext, session);
	EprocResponse htmlToReturn = new();
}
@{
	//'--Versione=1&data=2016-05-09&Attvita=108225&Nominativo=Leone
	//on error resume next

	//'call validate( "URN", replace(cstr(Request.QueryString("urn")),":","") , TIPO_PARAMETRO_STRING, SOTTO_TIPO_PARAMETRO_PAROLASINGOLA, "", 0 )
	validate("PFU", GetParamURL(Request.QueryString.ToString(), "pfu"), TIPO_PARAMETRO_STRING, SOTTO_TIPO_PARAMETRO_PAROLASINGOLA, "", 0, HttpContext, session);
	validate("RAW", GetParamURL(Request.QueryString.ToString(), "raw"), TIPO_PARAMETRO_INT, SOTTO_TIPO_VUOTO, "", 0, HttpContext, session);
	validate("ZIP", GetParamURL(Request.QueryString.ToString(), "zip"), TIPO_PARAMETRO_INT, SOTTO_TIPO_VUOTO, "", 0, HttpContext, session);

	throw new ResponseRedirectException("dettaglio.aspx?urn=" + URLEncode(GetParamURL(Request.QueryString.ToString(), "urn")) + "&pfu=" + URLEncode(GetParamURL(Request.QueryString.ToString(), "pfu")) + "&raw=" + URLEncode(GetParamURL(Request.QueryString.ToString(), "raw")) + "&zip=" + URLEncode(GetParamURL(Request.QueryString.ToString(), "zip")), Response);

	//'response.write "dettaglio.aspx?urn=" & Server.URLEncode(request.querystring("urn")) & "&pfu=" & Server.URLEncode(request.querystring("pfu")) & "&raw=" & Server.URLEncode(cstr(request.querystring("raw")))
		
	//'-- per testare l'errore
	//'response.redirect "dettaglio.aspx?pfu=xxxx&urn=" & Server.URLEncode(request.querystring("urn")) 

}
@Html.Raw(htmlToReturn.Out())