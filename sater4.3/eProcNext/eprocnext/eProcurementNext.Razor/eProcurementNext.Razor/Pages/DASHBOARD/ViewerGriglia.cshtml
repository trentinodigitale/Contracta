@page "/DASHBOARD/ViewerGriglia.asp"
@using eProcurementNext.CommonModule
@using eProcurementNext.DashBoard
@using Microsoft.VisualBasic
@using static eProcurementNext.Razor.Pages.CTL_LIBRARY.functions.intestModel;
@using static eProcurementNext.CommonModule.Basic;
@using eProcurementNext.Application;
@inject eProcurementNext.Session.ISession session;
@inject IConfiguration configuration;
@using static eProcurementNext.Session.SessionMiddleware
@model eProcurementNext.Razor.Pages.DASHBOARD.ViewerGrigliaModel
@{
	LoadSession(HttpContext, session);
	EprocResponse htmlToReturn = new EprocResponse(GetParamURL(HttpContext.Request.QueryString.ToString(), "XML_ATTACH_TYPE"));
}
@{
	if(CStr(GetParamURL(Request.QueryString.ToString(), "ajax")) == "1" )
	{
		Response.Headers.TryAdd("Access-Control-Allow-Origin", "*");		
		ViewerGriglia viewGriglia = new ViewerGriglia(configuration,HttpContext,session,htmlToReturn);
		viewGriglia.run(htmlToReturn);
		throw new ResponseEndException(htmlToReturn.Out(), Response, "");
	}

	StartPage(htmlToReturn);

	string PATH_STYLE = GetParamURL(Request.QueryString.ToString(), "PATH_STYLE");

	if(string.IsNullOrEmpty(PATH_STYLE))
	{
		PATH_STYLE = session["PATH_STYLE"];
	}
	htmlToReturn.Write($@"
	<link rel=stylesheet href=""../CTL_Library/Themes/"""+PATH_STYLE+$@"""body.css"" type=""text/css"">
	<link rel=stylesheet href=""../CTL_Library/Themes/"""+PATH_STYLE+$@"""griddocument.css"" type=""text/css"">
	<link rel=stylesheet href=""../CTL_Library/Themes/"""+PATH_STYLE+$@"""toolbarDocument.css"" type=""text/css"">
	<link rel=stylesheet href=""../CTL_Library/Themes/"""+PATH_STYLE+$@"""ButtonBar.css"" type=""text/css"">
	<link rel=stylesheet href=""../CTL_Library/Themes/"""+PATH_STYLE+$@"""SinteticHelp.css"" type=""text/css"">
	<link rel=stylesheet href=""../CTL_Library/Themes/"""+PATH_STYLE+$@"""ScrollPage.css"" type=""text/css"">
	<link rel=stylesheet href=""../CTL_Library/Themes/"""+PATH_STYLE+$@"""field.css"" type=""text/css"">
	<link rel=stylesheet href=""../CTL_Library/Themes/"""+PATH_STYLE+$@"""PropertySelector.css"" type=""text/css"">
	<link rel=stylesheet href=""../CTL_Library/Themes/"""+PATH_STYLE+$@"""group.css"" type=""text/css"">
	<link rel=stylesheet href=""../CTL_Library/Themes/"""+PATH_STYLE+$@"""calendar.css"" type=""text/css"">
	<link rel=stylesheet href=""../CTL_Library/Themes/"""+PATH_STYLE+$@"""model.css"" type=""text/css"">
	<link rel=stylesheet href=""../CTL_Library/Themes/"""+PATH_STYLE+$@"""print.css"" type=""text/css"" media=""print"">
	<link rel=stylesheet href=""../CTL_Library/Themes/"""+PATH_STYLE+$@"""base_viewer.css"" type=""text/css"">

	<link rel=""stylesheet"" href=""../CTL_Library/jscript/jquery/jquery-ui.css"" />
	<script src=""../CTL_Library/jscript/jquery/jquery-1.9.1.js""></script>
	<script src=""../CTL_Library/jscript/jquery/jquery-ui-1.10.1.custom.min.js""></script>
	<script src=""../CTL_LIBRARY/jscript/document/document.js"" type=""text/javascript""></script>");


	ViewerGriglia view = new ViewerGriglia(configuration,HttpContext,session,htmlToReturn);
	view.run(htmlToReturn);

	//'--se c'è un solo documento e se rischiesto lo apro

	if(CInt(GetParamURL(Request.QueryString.ToString(), "OPENDOCUMENT")) == 1)
	{
		htmlToReturn.Write(@"
		<script language=""javascript"">
			
			if (GridViewer_NumRow == 0){
				cod=prendiElementoDaId('GridViewer_idRow_0').value;
				
				var strDoc='';
				
				try { strDoc = getObj('DOCUMENT').value; } catch( e ) {};
				if ( strDoc == '' )
					//documento generico
					parent.location='"+ApplicationCommon.Application["strVirtualDirectory"]+@"/Aflcommon/FolderGeneric/PrintDoc.asp?FileTemplate=Portale1&lIdMsgPar=' + cod + '&Name=' + strDoc + '&lIdmpPar=1&StrCommandPar=OPENDOC&ProvenienzaPortale=1' ;
				else
					//nuovo documento
					parent.location = '"+ApplicationCommon.Application["strVirtualDirectory"]+@"/Report/' + strDoc + '.asp?PORTALE=1&IDDOC=' + cod + '&TYPEDOC=' + strDoc ;
			}
		</script>");
	}

}@Html.Raw(htmlToReturn.Out())