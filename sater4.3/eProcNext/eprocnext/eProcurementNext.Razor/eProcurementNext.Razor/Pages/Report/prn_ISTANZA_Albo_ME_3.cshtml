@page "/Report/prn_ISTANZA_Albo_ME_3.asp"
@inject eProcurementNext.Session.ISession session;
@using eProcurementNext.CommonDB
@using eProcurementNext.CommonModule;
@using static eProcurementNext.CommonModule.Basic;
@using eProcurementNext.BizDB;
@using eProcurementNext.HTML;
@using eProcurementNext.Application;
@using Microsoft.VisualBasic
@using System.Globalization
@using static eProcurementNext.CommonDB.Basic;
@using static eProcurementNext.Razor.Pages.CTL_LIBRARY.DOCUMENT.print_documentModel;
@using static eProcurementNext.Razor.Pages.CTL_LIBRARY.DOCUMENT.CommonModel;
@using static eProcurementNext.Razor.Pages.CTL_LIBRARY.functions.securityModel;
@using static eProcurementNext.Session.SessionMiddleware
@using static eProcurementNext.Razor.Pages.Report.prn_ISTANZA_Albo_ME_3Model;
@model eProcurementNext.Razor.Pages.Report.prn_ISTANZA_Albo_ME_3Model
@{
    CommonDbFunctions cdf = new();
    LoadSession(HttpContext, session);
    EprocResponse htmlToReturn = new();
    objDoc = PrintDocument(session, htmlToReturn, HttpContext, Response, Request);//PrintDocument ok
    string idDoc = objDoc.mp_IDDoc;
    var sqlParams = new Dictionary<string, object?>();

    htmlToReturn.Write($@"
	<html>
	<head>");
    addMetaTag(htmlToReturn);
    TSRecordSet? rsclassiiscrizione = null;
    string getClasseIscrizione(string cod)
    {
        string _getClasseIscrizione = "";
        try
        {
            if (rsclassiiscrizione is null)
            {
                sqlParams.Clear();
                sqlParams.Add("@ml_lng", GetParamURL(Request.QueryString.ToString(), "LanguageSuffix"));
                rsclassiiscrizione = cdf.GetRSReadFromQuery_("SELECT  DMV_DescML , DMV_Cod  FROM  ClasseIscriz_MLNG where ML_LNG=@ml_lng", ApplicationCommon.Application.ConnectionString, sqlParams);
            }
            rsclassiiscrizione.Filter("DMV_Cod = '" + cod + "'");
            if (!(rsclassiiscrizione.EOF && rsclassiiscrizione.BOF))
            {
                _getClasseIscrizione = CStr(rsclassiiscrizione["DMV_DescML"]);
            }
            else
            {
                _getClasseIscrizione = string.Empty;
            }
        }
        catch
        {

        }
        return _getClasseIscrizione;
    }
    string getProvincia(string cod)
    {
        string _getProvincia = string.Empty;
        TSRecordSet? rs = cdf.GetRSReadFromQuery_("declare @descrizione as nvarchar(MAX) set @descrizione='' select @descrizione=@descrizione + DMV_DescML + ',' from dbo.Split('" + cod + "','###') inner join LIB_DomainValues on DMV_DM_ID='GEO' and DMV_Cod=items select substring(@descrizione,0,len(@descrizione)) as descrizione", ApplicationCommon.Application.ConnectionString);
        if (rs is not null && rs.RecordCount > 0)
        {
            rs.MoveFirst();
            _getProvincia = CStr(rs["descrizione"]);
        }
        return _getProvincia;
    }
    string getVersioneDoc()
    {
        string _getVersioneDoc = string.Empty;
        sqlParams.Clear();
        sqlParams.Add("@id", CInt(idDoc));
        TSRecordSet? rs5 = cdf.GetRSReadFromQuery_("Select Versione from CTL_DOC with(nolock) where Id=@id", ApplicationCommon.Application.ConnectionString, sqlParams);
        if (rs5 is not null && rs5.RecordCount > 0)
        {
            rs5.MoveFirst();
            _getVersioneDoc = CStr(rs5["Versione"]);
        }
        return _getVersioneDoc;
    }
    string getClasseMerceologica(string cod)
    {
        string _getClasseMerceologica = string.Empty;
        sqlParams.Clear();
        sqlParams.Add("@cod", cod);
        TSRecordSet? rs = cdf.GetRSReadFromQuery_("SELECT  DMV_DescML  FROM Categorie_Merceologiche  where DMV_COD=@cod", ApplicationCommon.Application.ConnectionString, sqlParams);
        if (rs is not null && rs.RecordCount > 0)
        {
            rs.MoveFirst();
            _getClasseMerceologica = CStr(rs["DMV_DescML"]);
        }
        return _getClasseMerceologica;
    }
    dynamic getNumeroDetermina(string cod)
    {
        TSRecordSet? rs1 = null;
        dynamic _getNumeroDetermina = null;
        try
        {
            sqlParams.Clear();
            sqlParams.Add("@cod", cod);
            rs1 = cdf.GetRSReadFromQuery_("select dgrN from  Document_Bando where idheader=@cod", ApplicationCommon.Application.ConnectionString, sqlParams);
            rs1.MoveFirst();
            _getNumeroDetermina = CStr(rs1["dgrN"]);
        }
        catch
        {

        }
        return _getNumeroDetermina;

    }
    dynamic getDeterminaDel(string cod)
    {
        TSRecordSet rs2 = null;
        dynamic _getDeterminaDel = null;
        try
        {
            sqlParams.Clear();
            sqlParams.Add("@cod", cod);
            rs2 = cdf.GetRSReadFromQuery_("select dgrDel from Document_Bando where idheader=@cod", ApplicationCommon.Application.ConnectionString, sqlParams);
            rs2.MoveFirst();
            _getDeterminaDel = CStr(rs2["dgrDel"]);
        }
        catch
        {

        }
        return _getDeterminaDel;
    }
    int NumPag;
    NumPag = 0;
    /*dynamic iif(dynamic a ,dynamic b ,dynamic c )
    {
        if(a)
        {
            return b;
        }
        else
        {
            return c;
        }
    }*/
    htmlToReturn.Write($@"
	</head>
	<body");
    if ((DOC_FieldTecnical("DOCUMENT", "StatoDoc") == "Saved" || string.IsNullOrEmpty(DOC_FieldTecnical("DOCUMENT", "StatoDoc"))) && GetParamURL(Request.QueryString.ToString(), "TO_SIGN") == "no" || string.IsNullOrEmpty(GetParamURL(Request.QueryString.ToString(), "TO_SIGN")))
    {
        htmlToReturn.Write($@" style=""background-image:url(../images/bozza.jpg)"" ");
    }
    htmlToReturn.Write($@"
	>
	<style type=""text/css"">
	BODY,DIV ,TABLE, TD {{
			font-family:'Arial','Times New Roman',serif;
			font-size:9.9pt;
			font-style:normal;
			font-weight:normal


			}}
			.Input
			{{
			font-family:'Arial','Times New Roman',serif;
			font-size:10pt;
			font-style:normal;
			font-weight:bold

			}}

			.TITLE{{
			font-family:'Arial','Times New Roman',serif;
			font-size:12pt;
			font-style: bold;
			font-weight:bold



			}}
			.prodotti
			{{
			font-family:'Arial','Times New Roman',serif;
			font-size:7pt;
			font-style:normal;
			font-weight:bold

			}}



			@media print
			{{
			#Ricevuta {{}}
			}}

			@media screen
			{{
			#Ricevuta {{}}
			}}

			  ul li, table ul li {{ list-style-type:none; text-align:justify; }}
			  p	{{  text-align:justify;}}
			 .disc li {{ list-style-type:disc;}}
			 .disc li table td{{vertical-align:bottom;}}
			  h1{{font-size:1.3em; font-weight:bold; text-align:center;}}
			 .PaddingLeft{{ padding-left:3em;}}
			 .nomargin{{margin-top: -13px;}}
			  ul.ListStyleTypeNone li{{padding-top:0em; }}
			 .ListStyleTypeNone{{ list-style-type:none; }}
			 table.list{{ vertical-align:middle; margin-top:1em;}}
			 ul.disc{{padding-left:0em;}}
			 table td ul.disc{{padding-top:0em;padding-bottom:0em;margin-top: 0em;margin-bottom: 0em;}}
			 .DataGUUE{{ width:25em;}}
			.DataGURI{{ width:17em;}}
			 ul.ListStyleTypeNone {{padding-left:0em; }}
			 .lower-alpha li {{list-style-type: lower-alpha; overflow: inherit; margin-left: 30px;}}
		</style>
	<div style=""text-align: center;"">
			<center>
				<table style=""width: 800px; height: 1400px;""");
    Header();
    htmlToReturn.Write($@"
		<tr>
				<td height=""100%"" valign=""top"" >
						<div style=""text-align: center; width: 800px; align: center;"">
							<div>

								<div>

								</div>
								<br>



								<table style=""text-align: center; width: 100%"">

									<tr style=""background-color: Silver; height: 55px ; text-align: center; "">
										<td >");
    htmlToReturn.Write("<b>" + ApplicationCommon.CNV("INTESTAZIONE_ISTANZA_SDA_2") + "</b>");
    htmlToReturn.Write($@"
										<br>


										</td>
									</tr>

								</table>
							</div>

						</div>");
    htmlToReturn.Write(ApplicationCommon.CNV("ISTANZA_ALBO_ME_3_KEY_001").Replace("(((NumDetermina)))", DOC_Field("TESTATA", "NumDetermina")));
    htmlToReturn.Write($@"
	<div style=""width: 800px; margin-top: 15px; text-align: left"">

							<table>
								<tr>
									<td nowrap=""nowrap"">
										Il sottoscritto
									</td>
									<td>
										<font class=""Input"">
										" + DOC_FieldHTML("TESTATA", "NomeRapLeg") + $@"&nbsp; " + DOC_FieldHTML("TESTATA", "CognomeRapLeg") + $@"
										</font>
									</td>
									<td nowrap=""nowrap"">
										nato a
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "LocalitaRapLeg") + $@"
										</font>
									</td>
									<td nowrap=""nowrap"">
										Provincia
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "ProvinciaRapLeg") + $@"
										</font>
									</td>
								<td nowrap=""nowrap"">
											   Stato
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "StatoRapLeg") + $@"
										</font>
									</td>
									<td nowrap=""nowrap"">
										il
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "DataRapLeg") + $@"
										</font>
									</td>
								</tr>
							</table>");
    htmlToReturn.Write($@"
							<table>
								<tr>

									<td nowrap=""nowrap"">
										Codice Fiscale
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "CFRapLeg") + $@"
										</font>
									</td>
									<td nowrap=""nowrap"">
										Telefono
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "TelefonoRapLeg") + $@"
										</font>
									</td>
									<td nowrap=""nowrap"">
										Telefono 2
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "CellulareRapLeg") + $@"
										</font>
									</td>


									<td nowrap=""nowrap"">
										Residente a
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "ResidenzaRapLeg") + $@"
										</font>
									</td>

								</tr>
							</table>");
    htmlToReturn.Write($@"
	<table>
								<tr>

									<td nowrap=""nowrap"">
										Provincia
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "ProvResidenzaRapLeg") + $@"
										</font>
									</td>
									<td nowrap=""nowrap"">
											   Stato
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "StatoResidenzaRapLeg") + $@"
										</font>
									</td>
									<td nowrap=""nowrap"">
										Indirizzo
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "IndResidenzaRapLeg") + $@"
										</font>
									</td>
									<td nowrap=""nowrap"">
										Cap
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "CapResidenzaRapLeg") + $@"
										</font>
									</td>


									<td nowrap=""nowrap"">
										In qualit&agrave; di
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "RuoloRapLeg") + $@"
										</font>
									</td>

								</tr>
							</table>");
    htmlToReturn.Write($@"
	<table>
								<tr>
									<td nowrap=""nowrap"">
										Giusta procura per notaio
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "Procura") + $@"
										</font>
									</td>
									<td nowrap=""nowrap"">
										del
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "DelProcura") + $@"
										</font>
									</td>


									<td nowrap=""nowrap"">
										Numero Rep.
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "NumProcura") + $@"
										</font>
									</td>
									<td nowrap=""nowrap"">
										Raccolta Numero
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "NumRaccolta") + $@"
										</font>
									</td>
								</tr>
							</table>");
    htmlToReturn.Write($@"
	<table>
								<tr>

									<td nowrap=""nowrap"">
										Della Società
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "RagSoc") + $@"
										</font>
									</td>");
    htmlToReturn.Write($@"<!--td nowrap=""nowrap"">
	Forma Giuridica
	</td>
	<td>
	<font class=""Input"">
	" + DOC_FieldHTML("TESTATA", "NaGi") + $@"
	</font>
	</td-->");
    htmlToReturn.Write($@"
									<table>
							<table>
								<tr>

									<td nowrap=""nowrap"">
										Iscritta a
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "SedeCCIAA") + $@"
										</font>
									</td>
									<td nowrap=""nowrap"">
										con il numero:
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "IscrCCIAA") + $@"
										</font>
									</td>");
    htmlToReturn.Write($@"
	<table>
								<tr>
									<td nowrap=""nowrap"">
										Codice Fiscale
									</td>

									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "codicefiscale") + $@"
										</font>
									</td>
									<td nowrap=""nowrap"">
										P. Iva
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "PIVA") + $@"
										</font>
									</td>
								</tr>
							</table>");
    htmlToReturn.Write($@"
	<table>
								<tr>

									<td nowrap=""nowrap"">
										Con sede legale in via
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "INDIRIZZOLEG") + $@"
										</font>
									</td>
									<td nowrap=""nowrap"">
										Comune
									</td>

									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "LOCALITALEG") + $@"
										</font>
									</td>

								</tr>
							</table>

							<table>
								<tr>

									<td nowrap=""nowrap"">
										C.a.p.
									</td>

									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "CAPLEG") + $@"
										</font>
									</td>
									<td nowrap=""nowrap"">
										Provincia
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "PROVINCIALEG") + $@"
										</font>
									</td>

									<td nowrap=""nowrap"">
										   Stato
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "STATOLOCALITALEG") + $@"
										</font>
									</td>
								</tr>
							</table>");
    htmlToReturn.Write($@"
							<table>
								</tr>
									<td nowrap=""nowrap"">
										Telefono <em>(1)</em>
									</td>

									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "NUMTEL") + $@"
										</font>
									</td>
									<td nowrap=""nowrap"">
										Telefono <em>(2)</em>
									</td>
									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "NUMTEL2") + $@"
										</font>
									</td>
									<td nowrap=""nowrap"">
										Fax
									</td>

									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "NUMFAX") + $@"
										</font>
									</td>

									<td nowrap=""nowrap"">
										E-mail Pec
									</td>

									<td>
										<font class=""Input"">
											" + DOC_FieldHTML("TESTATA", "EMAIL") + $@"
										</font>
									</td>

								</tr>
							</table>");
    string val_ISTANZA_ALBO_ME_3_KEY_002 = ApplicationCommon.CNV("ISTANZA_ALBO_ME_3_KEY_002");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace("(((Riferimento_Gazzetta)))", "<b>" + DOC_Field("TESTATA", "Riferimento_Gazzetta") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace("(((CampoTesto_10)))", "<b>" + DOC_Field("TESTATA", "CampoTesto_10") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace("(((NumDetermina)))", "<b>" + DOC_Field("TESTATA", "NumDetermina") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace("(((DataInvioGara)))", "<b>" + DOC_Field("TESTATA", "DataInvioGara") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace("(((Data_Pubblicazione_Gazzetta)))", "<b>" + DOC_Field("TESTATA", "Data_Pubblicazione_Gazzetta") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace($@"(((CheckIscritta1)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA", "CheckIscritta1") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace("(((Registro_Camera_Provincia_Artigianato))) ", "<b>" + DOC_Field("TESTATA", "Registro_Camera_Provincia_Artigianato") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace("(((Registro_Provincia_Artigianato))) ", "<b>" + DOC_Field("TESTATA", "Registro_Provincia_Artigianato") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace("(((elenco_camera_attivita_artigianato)))", "<b>" + DOC_Field("TESTATA", "elenco_camera_attivita_artigianato") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace("(((numero_iscrizione)))", "<b>" + DOC_Field("TESTATA", "numero_iscrizione") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace("(((data_iscrizione)))", "<b>" + DOC_Field("TESTATA", "data_iscrizione") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace("(((NaGi)))", "<b>" + DOC_Field("TESTATA", "NaGi") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace("(((sede_iscrizione)))", "<b>" + DOC_Field("TESTATA", "sede_iscrizione") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace("(((CF_iscrizione)))", "<b>" + DOC_Field("TESTATA", "CF_iscrizione") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace("(((IVA_iscrizione)))", "<b>" + DOC_Field("TESTATA", "IVA_iscrizione") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace($@"(((CheckIscritta2)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA", "CheckIscritta2") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace($@"(((CheckIscritta3)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA", "CheckIscritta3") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace($@"(((CheckSoggetti1)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA", "CheckSoggetti1") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace($@"(((CheckSoggetti2)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA", "CheckSoggetti2") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace($@"(((CheckSoggetti3)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA", "CheckSoggetti3") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_002 = val_ISTANZA_ALBO_ME_3_KEY_002.Replace($@"(((CheckSoggetti4)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA", "CheckSoggetti4") == "1", "", "un") + @"checked.gif"" /></font>");

    htmlToReturn.Write(val_ISTANZA_ALBO_ME_3_KEY_002);
    htmlToReturn.Write($@"
			</div>
			</div>
		</td>
	</tr>");
    footer();
    htmlToReturn.Write("</table>");
    htmlToReturn.Write($@"<!-- fine pagina 1-->");
    PrintPagina();
    htmlToReturn.Write($@"<table style=""width: 800px; height: 1400px;""");
    Header();
    htmlToReturn.Write($@"
	<tr>
						<td height=""100%"" valign=""top"">
							<div style=""text-align: left; width: 100%"">
							 <br/>");
    string val_ISTANZA_ALBO_ME_3_KEY_003 = ApplicationCommon.CNV("ISTANZA_ALBO_ME_3_KEY_003");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((CampoTesto_11)))", "<b>" + DOC_Field("TESTATA2", "CampoTesto_11") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_1)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_1") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_2)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_2") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((Dichiarazione_check_art_80_1)))", "<b>" + DOC_Field("TESTATA2", "Dichiarazione_check_art_80_1") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_blacklist_1)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_blacklist_1") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_blacklist_2)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_blacklist_2") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_violazioni_1)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_violazioni_1") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_violazioni_2)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_violazioni_2") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_infrazioni_1)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_infrazioni_1") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_infrazioni_2)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_infrazioni_2") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_fallimento_1)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_fallimento_1") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_fallimento_2)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_fallimento_2") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_fallimento_3)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_fallimento_3") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_fallimento_4)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_fallimento_4") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_fallimento_5)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_fallimento_5") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_fallimento_6)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_fallimento_6") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_illeciti_1)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_illeciti_1") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_illeciti_2)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_illeciti_2") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_conflitti_1)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_conflitti_1") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_conflitti_2)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_conflitti_2") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_appalto_1)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_appalto_1") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_appalto_2)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_appalto_2") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_fiduciaria_1)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_fiduciaria_1") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_fiduciaria_2)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_fiduciaria_2") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_assunzioni_1)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_assunzioni_1") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_assunzioni_2)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_assunzioni_2") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_controllo_1)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_controllo_1") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_controllo_2)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_controllo_2") == "1", "", "un") + @"checked.gif"" /></font>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((check_art_80_Dichiarazione)))", $@"<font class=""Input""><img src=""../ctl_library/images/domain/" + IIF(DOC_Field("TESTATA2", "check_art_80_Dichiarazione") == "1", "", "un") + @"checked.gif"" /></font>");

    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((PEC_Entrate)))", $@"<b>" + DOC_Field("TESTATA2", "PEC_Entrate") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((IndirizzoEntrate)))", $@"<b>" + DOC_Field("TESTATA2", "IndirizzoEntrate") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((Province_Dove_Opera)))", "$@<b>" + getProvincia(DOC_FieldTecnical("TESTATA2", "Province_Dove_Opera")) + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((Tempi_Medi_gg_consegna)))", $@"<b>" + DOC_Field("TESTATA2", "Tempi_Medi_gg_consegna") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((Fatturato_ultimo_anno)))", $@"<b>" + DOC_Field("TESTATA2", "Fatturato_ultimo_anno") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((PEC_disabili)))", $@"<b>" + DOC_Field("TESTATA2", "PEC_disabili") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((sede_disabili)))", $@"<b>" + DOC_Field("TESTATA2", "sede_disabili") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((DataInvioGara)))", $@"<b>" + DOC_Field("TESTATA2", "DataInvioGara") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((NomeBando)))", $@"<b>" + DOC_Field("TESTATA2", "NomeBando") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((Tribunale_Chk_fall_2)))", $@"<b>" + DOC_Field("TESTATA2", "Tribunale_Chk_fall_2") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((Provvedimento_Chk_fall_2)))", $@"<b>" + DOC_Field("TESTATA2", "Provvedimento_Chk_fall_2") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((del_Chk_fall_2))) ", $@"<b>" + DOC_Field("TESTATA2", "del_Chk_fall_2") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((Tribunale_Chk_fall_3))) ", $@"<b>" + DOC_Field("TESTATA2", "Tribunale_Chk_fall_3") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((Provvedimento_Chk_fall_3))) ", $@"<b>" + DOC_Field("TESTATA2", "Provvedimento_Chk_fall_3") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((del_Chk_fall_3))) ", $@"<b>" + DOC_Field("TESTATA2", "del_Chk_fall_3") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((Tribunale_Chk_fall_3_2))) ", $@"<b>" + DOC_Field("TESTATA2", "Tribunale_Chk_fall_3_2") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((Provvedimento_Chk_fall_3_2))) ", $@"<b>" + DOC_Field("TESTATA2", "Provvedimento_Chk_fall_3_2") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((del_Chk_fall_3_2))) ", $@"<b>" + DOC_Field("TESTATA2", "del_Chk_fall_3_2") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((Tribunale_Chk_fall_4))) ", $@"<b>" + DOC_Field("TESTATA2", "Tribunale_Chk_fall_4") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((Provvedimento_Chk_fall_4))) ", $@"<b>" + DOC_Field("TESTATA2", "Provvedimento_Chk_fall_4") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((del_Chk_fall_4))) ", $@"<b>" + DOC_Field("TESTATA2", "del_Chk_fall_4") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((Tribunale_Chk_fall_4_2))) ", $@"<b>" + DOC_Field("TESTATA2", "Tribunale_Chk_fall_4_2") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((Provvedimento_Chk_fall_4_2))) ", $@"<b>" + DOC_Field("TESTATA2", "Provvedimento_Chk_fall_4_2") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace($@"(((del_Chk_fall_4_2))) ", $@"<b>" + DOC_Field("TESTATA2", "del_Chk_fall_4_2") + "</b>");

    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace("(((testo_check_dichiarazione))) ", $@"<b>" + DOC_Field("TESTATA2", "testo_check_dichiarazione") + "</b>");
    val_ISTANZA_ALBO_ME_3_KEY_003 = val_ISTANZA_ALBO_ME_3_KEY_003.Replace("(((emailriferimentoazienda))) ", $@"<b>" + DOC_Field("TESTATA2", "emailriferimentoazienda") + "</b>");

    //'Stampa fino al punto Q)
    int fine = InStrVb6(1, val_ISTANZA_ALBO_ME_3_KEY_003, @"<strong>q)</strong> <b>dichiara:</b>");
    htmlToReturn.Write(MidVb6(val_ISTANZA_ALBO_ME_3_KEY_003, 1, fine - 1));
    //'response.write InStr(val_ISTANZA_ALBO_ME_3_KEY_003,"che, ai sensi dell’all’art. 80, co. 5, lett. c), D.Lgs. 50/2016,")
    //'response.write val_ISTANZA_ALBO_ME_3_KEY_003
    htmlToReturn.Write($@"
							</div>
							</div>
						</td>
					</tr>");
    footer();
    htmlToReturn.Write("</table>");
    htmlToReturn.Write($@"<!-- fine pagina 2-->");
    PrintPagina();
    htmlToReturn.Write($@"<table style=""width: 800px; height: 1400px;""");
    Header();
    htmlToReturn.Write($@"
	<tr>
		<td height=""100%"" valign=""top"">
			<div style=""text-align: left; width: 100%"">
				<div>");
    //'STAMPA DAL PUNTO Q)
    //'response.write InStr(val_ISTANZA_ALBO_ME_3_KEY_003,"<li><strong>h)</strong> che, ai sensi dell'art. 80, co. 5, lett. b), D.Lgs. 50/2016, <em>(Selezionare il punto relativo alla propria situazione)</em>:")
    int start = InStrVb6(1, val_ISTANZA_ALBO_ME_3_KEY_003, @"<strong>q)</strong> <b>dichiara:</b>");
    //'fine=Instr(val_ISTANZA_ALBO_ME_3_KEY_003,"<strong>m)</strong> che, ai sensi dell'art. 80, co. 5, lett. i), <em>(Selezionare il punto relativo alla propria situazione)</em>:")
    htmlToReturn.Write(Strings.Mid(val_ISTANZA_ALBO_ME_3_KEY_003, start));
    string stringa = "";
    string[] arr = null;


    stringa = DOC_FieldTecnical("DISPLAY_CLASSI", "ClasseIscriz");
    arr = stringa.Split("###");

    for (int i = 1; i < arr.Length - 1; i++)
    {
        htmlToReturn.Write($@"<br><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" + getClasseIscrizione(arr[i]) + "</b>");
    }
    htmlToReturn.Write(ApplicationCommon.CNV("ISTANZA_ALBO_ME_3_KEY_004"));

    int row6 = 0;
    row6 = DOC_NumRow("DOCUMENTAZIONE", "");
    htmlToReturn.Write($@"
	<table style=""border: 0px solid black; border-collapse: collapse; width: 80%"" align=""center"" cellpadding=""5"">
	<tr style=""height: 18px"">
	<td style=""border: 0px solid black;"" width=""40%"">Descrizione</td>
	<td style=""border: 0px solid black;"" width=""40%"">Allegato</td>
	</tr> ");
    for (int i = 0; i < row6 - 1; i++)
    {
        htmlToReturn.Write($@"
		<tr style=""height: 20px"">
		<td style=""border: 0px solid black;"" width=""20%""><font class=""Input"">" + DOC_FieldRow("DOCUMENTAZIONE", "Descrizione", i) + $@"</font></td>
		<td style=""border: 0px solid black;"" width=""20%""><font class=""Input"">" + DOC_FieldRow("DOCUMENTAZIONE", "Allegato", i) + $@"</font></td>
		</tr>");
    }
    htmlToReturn.Write($@"
								</table>

								</div>
							</div>
						</td>
					</tr>");
    footer();
    htmlToReturn.Write($@"
	</table>


	</center>

	</body>
	</html>");
    void PrintPagina()
    {
        htmlToReturn.Write($@"<div style=""page-break-after: always""></div>");
    }
    void footerold()
    {
        NumPag = NumPag + 1;
        htmlToReturn.Write($@"
		<br />

		<hr />
		<table width=""720px"" style=""vertical-align: bottom; bottom: 0px"">
			<tr>
				<td valign=""bottom"" align=""right"">
					<br>
					" + NumPag + $@"
				</td>
			</tr>
		</table>");
    }
    void Header()
    {
        if (DOC_FieldTecnical("DOCUMENT", "StatoDoc") == "Annullato")
        {
            htmlToReturn.Write($@" style=""background-image:url(../images/annullato.gif) ; background-repeat:no-repeat;"" >");
        }
        else
        {
            htmlToReturn.Write(">");
        }
        htmlToReturn.Write($@"<tr><td height=""50px"" align=""center"" valign=""top"" >");
        string imgHeader = ApplicationCommon.CNV("HEADER_STAMPE");
        if (imgHeader.Contains("???", StringComparison.Ordinal))
        {
            htmlToReturn.Write($@"<img height=""50px"" src=""logo_new.gif"" border=""0"" alt=""" + ApplicationCommon.CNV("ALT LOGO") + $@"""/>");
        }
        else
        {
            htmlToReturn.Write(imgHeader);
        }
        htmlToReturn.Write($@"</td></tr>");
    }
    //'------------------------------------------------------------------------------
    //'-- funzione per disegnare il pie pagina
    //'------------
    // ------------------------------------------------------------------
    void footer()
    {
        NumPag = NumPag + 1;

        htmlToReturn.Write($@"<tr><td valign=""bottom"" height=""10px"" >");
        htmlToReturn.Write($@"<table width=""720px"" height=""10px"" style=""vertical-align: bottom; bottom: 0px""> ");
        htmlToReturn.Write($@"        <tr><td align=""left"" style=""border-bottom: 1px solid black;"" ><b>" + ApplicationCommon.CNV("ISTANZA_ALBO_ME_3_KEY_FOOTER") + "</b></td></tr><tr>");
        htmlToReturn.Write($@"            <td valign=""bottom"" align=""right"" >");
        htmlToReturn.Write($@"                ");
        htmlToReturn.Write($@"                  <br>");
        htmlToReturn.Write($@"                " + NumPag);
        htmlToReturn.Write($@"            </td>");
        htmlToReturn.Write($@"        </tr>");
        htmlToReturn.Write($@"    </table>");
        htmlToReturn.Write($@"    </td></tr>");
    }
    //'-- Testo aggiunto in automatico per liberare la memoria dei nuovi report
    try
    {
        FreeMemDocument(session);
    }
    catch
    {

    }
}@Html.Raw(htmlToReturn.Out())