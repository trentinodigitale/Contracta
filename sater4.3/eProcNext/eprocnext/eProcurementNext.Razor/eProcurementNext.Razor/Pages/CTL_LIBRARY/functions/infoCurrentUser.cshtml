
@page "/CTL_LIBRARY/functions/infoCurrentUser.asp"
@inject eProcurementNext.Session.ISession session;
@using eProcurementNext.CommonDB
@using eProcurementNext.CommonModule;
@using static eProcurementNext.CommonModule.Basic;
@using eProcurementNext.BizDB;
@using eProcurementNext.HTML;
@using eProcurementNext.Application;
@using static eProcurementNext.HTML.BasicFunction;
@using Microsoft.VisualBasic;
@model eProcurementNext.Razor.Pages.CTL_LIBRARY.functions.infoCurrentUserModel
@using static eProcurementNext.Session.SessionMiddleware
@{
	LoadSession(HttpContext, session);
	EprocResponse htmlToReturn = new(GetParamURL(HttpContext.Request.QueryString.ToString(), "XML_ATTACH_TYPE"));
}
@{
	//--se passato recupero utente in input altrimenti quello loggato
	string Utente = GetParamURL(Request.QueryString.ToString(), "Utente");
	if (string.IsNullOrEmpty(Utente))
	{
		Utente = CStr(session["IdPfu"]);
	}
	//'--controllo se ci sono quesiti sul bando
	var sqlParams = new Dictionary<string, object?>();
     sqlParams.Add("@Utente", CInt(Utente)); 
	
	CommonDbFunctions cdb = new();
	TSRecordSet rs = cdb.GetRSReadFromQuery_("select  idazi,aziragionesociale,aziTelefono1,azifax,pfuE_Mail,aziIndirizzoLeg,aziLocalitaLeg,aziProvinciaLeg,codicefiscale,isnull(pfutel,'') as pfutel from DASHBOARD_VIEW_AZIENDE,profiliutente where idazi=pfuidazi and idpfu <> -20 and idpfu=@Utente", ApplicationCommon.Application.ConnectionString, sqlParams);

	if(rs.RecordCount >0)
	{
		rs.MoveFirst();
		htmlToReturn.Write($"{CStr(rs["aziragionesociale"])}#{CStr(rs["aziTelefono1"])}#{CStr(rs["azifax"])}#{CStr(rs["pfuE_Mail"])}#{CStr(rs["aziIndirizzoLeg"])}#{CStr(rs["aziLocalitaLeg"])}#{CStr(rs["aziProvinciaLeg"])}#{CStr(rs["codicefiscale"])}#{CStr(rs["idazi"])}#{CStr(rs["pfutel"])}");
	}
	else
	{
		htmlToReturn.Write("###");
	}
	
	throw new ResponseEndException(htmlToReturn.Out(), Response, "");
}@Html.Raw(htmlToReturn.Out())