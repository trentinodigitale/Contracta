@page "/CTL_LIBRARY/functions/Check_BandoRevocato.asp"
@inject eProcurementNext.Session.ISession session;
@using eProcurementNext.CommonDB
@using eProcurementNext.CommonModule;
@using static eProcurementNext.CommonModule.Basic;
@using eProcurementNext.BizDB;
@using eProcurementNext.HTML;
@using eProcurementNext.Application;
@using static eProcurementNext.HTML.BasicFunction;
@model eProcurementNext.Razor.Pages.CTL_LIBRARY.functions.Check_BandoRevocatoModel
@{
	//LoadSession(HttpContext, session);
	EprocResponse htmlToReturn = new(GetParamURL(HttpContext.Request.QueryString.ToString(), "XML_ATTACH_TYPE"));
}
@{

    string IDDOC = GetParamURL(Request.QueryString.ToString(), "IDDOC");
    string DOCUMENT = GetParamURL(Request.QueryString.ToString(), "DOCUMENT");
    string strResult = string.Empty;
    if (DOCUMENT == "DOCUMENTO_GENERICO")
    {
        // '--query per controllare se esiste una pda classica (169)
        var sqlParams = new Dictionary<string, object?>();
        sqlParams.Add("@IDDOC", IDDOC);
        string strSQL = " select IdMsg from TAB_MESSAGGI_FIELDS where AdvancedState='7' and IdDoc = @IDDOC";
        CommonDbFunctions cd = new();
        TSRecordSet rs = cd.GetRSReadFromQuery_(strSQL, ApplicationCommon.Application.ConnectionString, sqlParams);
        if (rs.RecordCount >0)
        {
            strResult ="1";
        }
        else
        {
            strResult="0";
        }
    }

    htmlToReturn.Write(strResult);
    //throw new ResponseEndException(htmlToReturn.Out(), "");
}@Html.Raw(htmlToReturn.Out())