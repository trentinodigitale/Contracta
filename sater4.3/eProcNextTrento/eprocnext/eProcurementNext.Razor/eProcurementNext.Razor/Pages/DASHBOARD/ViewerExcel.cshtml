@page "/DASHBOARD/ViewerExcel.asp"
@using eProcurementNext.Application
@using eProcurementNext.DashBoard
@using eProcurementNext.HTML
@using eProcurementNext.CommonModule
@using Microsoft.VisualBasic
@* <!-- #Include File="../CTL_Library/Functions/intestexcel.inc" --> *@
@using static eProcurementNext.Razor.Pages.CTL_LIBRARY.functions.intestModel 
@using static eProcurementNext.CommonModule.Basic;
@inject eProcurementNext.Session.ISession session;
@inject IConfiguration configuration;
@using static eProcurementNext.Session.SessionMiddleware
@model eProcurementNext.Razor.Pages.DASHBOARD.ViewerExcelModel
@{
	LoadSession(HttpContext, session);
	EprocResponse htmlToReturn = new EprocResponse(GetParamURL(HttpContext.Request.QueryString.ToString(), "XML_ATTACH_TYPE"));
}
@{
	string strFileName ="";

	strFileName = GetParamURL(Request.QueryString.ToString(), "FileNameExcel");
	if(string.IsNullOrEmpty(strFileName))
	{
		strFileName = "List.xls";
	}
	Response.ContentType = "application/x-msexcel";
	Response.Headers.Add("Content-Disposition", "attachment; filename=" + strFileName);

	StartPage(htmlToReturn);
	ViewerPrint view = new ViewerPrint(HttpContext, session, htmlToReturn, configuration);
	view.run();

	//'VERSIONE XLSX. APPENA FINITO LO SVILUPPO CON L'INTRODUZIONE DELLE DECODIFICHE DEI DOMINI
	//'TOGLIERE TUTTA LA PARTE SOPRA E LASCIARE SOLO QUESTA DECOMMENTANDOLA :
	//'Include File="../CTL_Library/Functions/intest.inc" -->
	//'Include File="../CTL_Library/Functions/security.inc" -->

//'accessGuid = insertAccessBarrier()
//'response.redirect "../ctl_library/xlsx.aspx?vexcel=1&hiddenViewerCurFilter=" & server.urlencode(cstr(Request.Form("hiddenViewerCurFilter"))) & "&acckey=" & server.urlencode(cstr(accessGuid)) & "&" & request.querystring

}@Html.Raw(htmlToReturn.Out())