@page "/CustomDoc/GetStatoGara.asp"
@inject eProcurementNext.Session.ISession session;
@using eProcurementNext.CommonDB;
@using eProcurementNext.CommonModule;
@using static eProcurementNext.CommonModule.Basic;
@using eProcurementNext.BizDB;
@using eProcurementNext.HTML;
@using eProcurementNext.Application;
@using static eProcurementNext.Razor.Pages.CustomDoc.GetStatoGaraModel;
@using Microsoft.VisualBasic;
@model eProcurementNext.Razor.Pages.CustomDoc.GetStatoGaraModel
@using static eProcurementNext.Session.SessionMiddleware
@{
	CommonDbFunctions cdf = new();
	LoadSession(HttpContext, session);
	EprocResponse htmlToReturn = new();
}
@{
	//	dim sBrowser, sBrowserType
	//sBrowser = request.serverVariables("HTTP_USER_AGENT")
	//if instr(1, sBrowser, "mozilla", 1)<>0 then
	//	if instr(1, sBrowser, "MSIE", 1)<>0 then
	//		sBrowserType = "ie"
	//	else
	//		sBrowserType = "netscape"
	//	end if
	//else
	//	sBrowserType = "unknown"
	//end if
	//
	//
	//select case sBrowserType
	//case "netscape"
	//	Response.AddHeader "Pragma", "no-cache"
	//	Response.AddHeader "cache-control", "private"
	//case "ie"
	//	Response.CacheControl = "no-cache"
	//	Response.AddHeader "Pragma", "no-cache"
	//	Response.Expires = -1
	//	Response.ExpiresAbsolute = #January 1, 1990 00:00:01# 
	//case else
	//	Response.Expires=0
	//end select
	string ProtBando = GetParamURL(Request.QueryString.ToString(), "ProtocolloBando");
	//'--recupero ProtocolloBando del bando collegato   & ProtBando
	var SqlParameters = new Dictionary<string, object?>();
    SqlParameters.Add("@protocollobando", ProtBando);
	SqlParameters.Add("@gara","garaconclusa");
	TSRecordSet? rs = cdf.GetRSReadFromQuery_("select IdProgetto from Document_Progetti where ProtocolloBando = @protocollobando and Storico=0 and StatoProgetto = @gara", ApplicationCommon.Application.ConnectionString, SqlParameters);
	if(rs.RecordCount > 0)
	{
		htmlToReturn.Write("1");
	}
	else
	{
		htmlToReturn.Write("0");
	}
}
@Html.Raw(htmlToReturn.Out())